<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasnim's AI Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b px-6 py-4 flex justify-between items-center sticky top-0 z-10">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">T</div>
            <h1 class="text-xl font-bold text-gray-800">AI Studio</h1>
        </div>
        <div id="status-badge" class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
            System Ready
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 max-w-4xl mx-auto w-full p-4 md:p-8 space-y-8">
        
        <!-- Introduction Section -->
        <section class="text-center space-y-2">
            <h2 class="text-3xl font-extrabold text-gray-900">Explore AI Creativity</h2>
            <p class="text-gray-600 max-w-lg mx-auto">Generate high-quality images and chat with an advanced AI model directly from this dashboard.</p>
        </section>

        <div class="grid grid-cols-1 gap-8">
            
            <!-- Image Generation Card -->
            <div class="glass-card rounded-2xl p-6 shadow-sm">
                <div class="flex items-center gap-3 mb-4">
                    <span class="p-2 bg-purple-100 text-purple-600 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-800">Imagen 4.0 Generator</h3>
                </div>
                
                <div class="space-y-4">
                    <textarea id="image-prompt" rows="3" class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all" placeholder="Describe the image you want to create (e.g., 'A futuristic city built on a giant floating leaf')"></textarea>
                    
                    <button id="generate-image-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors flex justify-center items-center gap-2">
                        <span>Generate Image</span>
                    </button>
                </div>

                <!-- Image Result Area -->
                <div id="image-result-container" class="mt-6 hidden">
                    <div id="image-loading" class="flex flex-col items-center justify-center p-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200">
                        <div class="loader mb-4"></div>
                        <p class="text-gray-500 text-sm">Visualizing your prompt...</p>
                    </div>
                    <img id="generated-image" class="w-full rounded-xl shadow-lg border border-gray-100 hidden" alt="AI Generated">
                </div>
            </div>

            <!-- Chat AI Card -->
            <div class="glass-card rounded-2xl p-6 shadow-sm">
                <div class="flex items-center gap-3 mb-4">
                    <span class="p-2 bg-blue-100 text-blue-600 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-800">Gemini 2.5 Flash Chat</h3>
                </div>

                <div class="space-y-4">
                    <div id="chat-history" class="h-64 overflow-y-auto space-y-4 p-4 bg-gray-50 rounded-xl border border-gray-100">
                        <div class="text-center text-gray-400 text-sm mt-20">No conversation started. Ask me anything!</div>
                    </div>
                    
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" class="flex-1 p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ask a question...">
                        <button id="send-chat-btn" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-xl transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center p-6 text-gray-500 text-xs">
        &copy; 2024 Tasnim Mahmud. Built for Educational Purposes. Powered by Google Gemini & Imagen.
    </footer>

    <!-- Scripts -->
    <script>
        const apiKey = ""; // Set by the environment

        // Helper: Exponential Backoff Fetch
        async function fetchWithRetry(url, options, retries = 5, backoff = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                return await response.json();
            } catch (err) {
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, backoff));
                    return fetchWithRetry(url, options, retries - 1, backoff * 2);
                }
                throw err;
            }
        }

        // --- IMAGE GENERATION LOGIC ---
        const imageBtn = document.getElementById('generate-image-btn');
        const imagePromptInput = document.getElementById('image-prompt');
        const imageResultContainer = document.getElementById('image-result-container');
        const imageLoading = document.getElementById('image-loading');
        const generatedImage = document.getElementById('generated-image');

        imageBtn.addEventListener('click', async () => {
            const prompt = imagePromptInput.value.trim();
            if (!prompt) return;

            imageBtn.disabled = true;
            imageResultContainer.classList.remove('hidden');
            imageLoading.classList.remove('hidden');
            generatedImage.classList.add('hidden');

            try {
                const payload = {
                    instances: [{ prompt: prompt }],
                    parameters: { sampleCount: 1 }
                };

                const result = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }
                );

                const base64Data = result.predictions[0].bytesBase64Encoded;
                generatedImage.src = `data:image/png;base64,${base64Data}`;
                generatedImage.classList.remove('hidden');
                imageLoading.classList.add('hidden');
            } catch (error) {
                console.error(error);
                imageResultContainer.innerHTML = `<p class="text-red-500 text-center p-4">Error generating image. Please try again.</p>`;
            } finally {
                imageBtn.disabled = false;
            }
        });

        // --- CHAT LOGIC ---
        const chatBtn = document.getElementById('send-chat-btn');
        const chatInput = document.getElementById('chat-input');
        const chatHistory = document.getElementById('chat-history');

        function appendMessage(role, text) {
            if (chatHistory.innerText === "No conversation started. Ask me anything!") {
                chatHistory.innerHTML = "";
            }
            const div = document.createElement('div');
            div.className = `p-3 rounded-lg max-w-[80%] ${role === 'user' ? 'ml-auto bg-blue-600 text-white' : 'mr-auto bg-white border border-gray-100 shadow-sm text-gray-800'}`;
            div.innerText = text;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        chatBtn.addEventListener('click', async () => {
            const query = chatInput.value.trim();
            if (!query) return;

            appendMessage('user', query);
            chatInput.value = "";
            chatBtn.disabled = true;

            try {
                const payload = {
                    contents: [{ parts: [{ text: query }] }],
                    systemInstruction: { parts: [{ text: "You are a helpful AI assistant created for Tasnim's educational app. Be concise and friendly." }] }
                };

                const result = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }
                );

                const aiResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't process that.";
                appendMessage('ai', aiResponse);
            } catch (error) {
                console.error(error);
                appendMessage('ai', "Error: Failed to connect to AI server.");
            } finally {
                chatBtn.disabled = false;
            }
        });

        // Enter key support for chat
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') chatBtn.click();
        });
    </script>
</body>
</html>

